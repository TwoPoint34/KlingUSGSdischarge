# 20251209_2020AllenCreekDischarge.R
# Example script: retrieve water-quality data from USGS / EPA WQP, then summarize and plot

# Install and load required packages
if (!require(dataRetrieval)) {
  install.packages("dataRetrieval")
}
library(dataRetrieval)

if (!require(dplyr)) {
  install.packages("dplyr")
}
library(dplyr)

if (!require(ggplot2)) {
  install.packages("ggplot2")
}
library(ggplot2)

# Example: fetch water quality samples for a location / parameter
# Replace siteNumber, parameterCd, startDate, endDate with what you need

siteNumber <- "04174490"   # example USGS site (river / stream gauge) â€” change as needed
parameterCd <- "00060"     # discharge (streamflow), for example. You could pick water-quality parameter instead
startDate <- "2020-01-01"
endDate <- "2021-01-01"

df <- readNWISdata(sites = siteNumber,
                   parameterCd = parameterCd,
                   startDate = startDate,
                   endDate = endDate)

# Inspect and clean data
str(df)

# Pick the column that ends with _00003 (mean)
value_col <- names(df)[grep("_00003$", names(df))]

df_clean <- df %>%
  rename(date = dateTime, value = all_of(value_col)) %>%
  filter(!is.na(value))



# Basic summary statistics
summary_stats <- df_clean %>%
  summarise(n = n(),
            min = min(value),
            median = median(value),
            mean = mean(value),
            max = max(value),
            sd = sd(value))

print(summary_stats)

# Plot time series
ggplot(df_clean, aes(x = date, y = value)) +
  geom_line() +
  labs(title = paste("Site", siteNumber, "- parameter", parameterCd),
       x = "Date", y = "Value")

# Optional: simple trend analysis (linear regression over time)
df_clean <- df_clean %>%
  mutate(days = as.numeric(difftime(date, min(date), units = "days")))

model <- lm(value ~ days, data = df_clean)
summary(model)

# Plot with trend line
ggplot(df_clean, aes(x = date, y = value)) +
  geom_line(alpha = 0.6) +
  geom_smooth(method = "lm", col = "red") +
  labs(title = paste("Trend for Site", siteNumber),
       x = "Date", y = "Value")
